# Callbacks Configuration

# Model Checkpoint - 保存最佳模型
model_checkpoint:
  _target_: lightning.pytorch.callbacks.ModelCheckpoint
  dirpath: ${paths.output_dir}/checkpoints
  filename: "epoch{epoch:03d}_val_loss{val_loss:.4f}"
  monitor: "val_loss"
  mode: "min"
  save_top_k: 3
  save_last: true
  auto_insert_metric_name: false
  verbose: false

# Early Stopping
early_stopping:
  _target_: lightning.pytorch.callbacks.EarlyStopping
  monitor: "val_loss"
  patience: 50
  mode: "min"
  verbose: true
  min_delta: 0.001

# Learning Rate Monitor
lr_monitor:
  _target_: lightning.pytorch.callbacks.LearningRateMonitor
  logging_interval: "epoch"
  log_momentum: false

# Model Summary
model_summary:
  _target_: lightning.pytorch.callbacks.RichModelSummary
  max_depth: 2

# Progress Bar
rich_progress_bar:
  _target_: lightning.pytorch.callbacks.RichProgressBar
  leave: true
  refresh_rate: 1
  theme:
    _target_: lightning.pytorch.callbacks.progress.rich_progress.RichProgressBarTheme
    description: "bold italic #FF00FF"
    progress_bar: "#6A0DAD"
    progress_bar_finished: "#FF0000"
    progress_bar_pulse: "#00FF00"
    batch_progress: "bold #FF00FF"
    time: "#9370DB"
    processing_speed: "#00FFFF"
    metrics: "bold #FFA500"

# Image Logger
# image_logger:
#   _target_: callbacks.image_logger.ImageLogger
#   num_samples: 4
#   log_key: "val/hand_samples"
image_logger: null

# Device Stats Monitor (GPU/CPU usage)
device_stats_monitor: null
# device_stats_monitor:
#   _target_: callbacks.light_device_stats_monitor.LightDeviceStatsMonitor
#   log_every_n_train_batches: 50
#   log_every_n_val_batches: 50
#   log_every_n_test_batches: 50
#   prefix: "device"

# Stochastic Weight Averaging
stochastic_weight_averaging: null

# stochastic_weight_averaging:
#   _target_: lightning.pytorch.callbacks.StochasticWeightAveraging
#   swa_lrs: 1e-3
#   swa_epoch_start: 0.8

# New Callbacks
ema:
  _target_: callbacks.ema.ModelEma
  decay: 0.999
  ema_device: null
  update_every_n_steps: 20

validation_summary:
  _target_: callbacks.validation_summary.ValidationSummaryCallback

# hand_vis:
#   _target_: callbacks.visualization.HandVisCallback
#   num_samples: 4
#   sample_num_steps: 20

# Gradient Norm Logger (Uncomment to enable)
# grad_norm:
#   _target_: callbacks.grad_norm_logger.GradNormLogger
#   norm_type: 2.0
