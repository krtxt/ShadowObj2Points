# Main Configuration File for HandPoseReconstruction Training
# @package _global_

# defaults list
defaults:
  - datamodule: handencoder_dm_dex_debug
  - model: flow_matching_hand_dit # deterministic_hand_dit | flow_matching_hand_dit
  - backbone: ptv3_sparse
  - hand_encoder: transformer_bias
  - dit: graph_dit_default
  - velocity_strategy: group_rigid
  - loss: flow_matching # deterministic_regression | flow_matching
  - optimizer: adamw
  - trainer: default
  - logger: tensorboard   # tensorboard
  - callbacks: default
  - _self_
  - experiments: null # Changed from experiment to experiments to match folder structure

# Experiment settings
experiment_name: exp_grasp16_1120
seed: 42

# Advanced Training Controls
auto_scale_batch_size: false # Set to true to find the largest batch size
auto_lr_find: false          # Set to true to find the optimal learning rate
auto_resume: false           # Set to true to resume from the last checkpoint in the experiment folder
auto_resume_config: false
validate_checkpoint: true    # Validate checkpoint integrity before resuming

# Resume from a specific run directory (supports relative paths from project root)
# Example: resume_run_dir=outputs/exp_xxx/2025-11-29_21-31-51
# This will load last.ckpt and .hydra/config.yaml from the specified directory
resume_run_dir: null
# If true, resume training in the original directory (keeps checkpoint paths consistent)
resume_in_place: false

# Common hyperparameters (可被其他配置引用)
batch_size: 128
rot_type: r6d  # 'quat' | 'r6d' | 'euler' | 'axis'
hand_anchor: palm_center  # 'base' | 'palm_center' | 'mjcf'
# PyTorch 2.x 编译（torch.compile），已改为仅编译 DiT 部分以避免 Inductor 错误
compile: true

# Paths
paths:
  # Use the original working directory (project root), not Hydra's run dir
  root_dir: ${hydra:runtime.cwd}
  data_dir: ${paths.root_dir}/data
  output_dir: ${paths.root_dir}/outputs/${experiment_name}/${now:%Y-%m-%d_%H-%M-%S}
  assets_dir: ${paths.root_dir}/assets

# Hydra settings
hydra:
  run:
    dir: ${paths.output_dir}
  sweep:
    dir: ${paths.root_dir}/outputs/sweeps/${now:%Y-%m-%d_%H-%M-%S}
    subdir: ${hydra.job.num}
  job:
    chdir: true  # Change working directory to output directory
    env_set:
      PYTHONPATH: ${hydra:runtime.cwd}/src:${oc.env:PYTHONPATH,""}



# python train.py experiments=profiler batch_size=256 experiment_name=exp_1121_group_rigid  velocity_strategy=group_rigid 
# python train.py experiments=profiler batch_size=256 experiment_name=exp_1121_pbd_corrected   velocity_strategy=pbd_corrected  
# python train.py experiments=profiler batch_size=256 experiment_name=exp_1121_phys_guided   velocity_strategy=phys_guided  
# python train.py experiments=profiler batch_size=256 experiment_name=exp_1121_direct  velocity_strategy=direct 
# python train.py experiments=profiler batch_size=256 experiment_name=exp_1121_direct_tangent  velocity_strategy=direct_tangent 
# python train.py experiments=profiler batch_size=256 experiment_name=exp_1121_goal_kabsch  velocity_strategy=goal_kabsch 